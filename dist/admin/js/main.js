(()=>{"use strict";const t=()=>document.querySelector("table").insertAdjacentHTML("afterend",'<p style="width:400px;margin: 0 auto;">Произошла ошибка, данных нет!</p>');class e{async dataGet(e=""){try{const a=await fetch(`http://localhost:4545/data${e}`);if(a.ok)return await a.json();throw t()}catch(t){t()}}async dataSend(e,a,n=""){try{const o=await fetch(`http://localhost:4545/data${n}`,{method:e,headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(a)});if(o.ok)return await o.json();throw t()}catch(t){t()}}}const a=t=>{const e=document.getElementById("tbody");e.innerHTML="",t.forEach((t=>{e.insertAdjacentHTML("beforeend",`<tr class="table__row" data-key="${t.id}">\n        <td class="table__id table__cell">${t.id}</td>\n        <td class="table-type table__cell">${t.type}</td>\n        <td class="table-name table__cell">\n          ${t.name}\n        </td>\n        <td class="table-units table__cell">\n          ${"м2"===t.units?t.units[0]+"<sup>"+t.units[1]:t.units}\n        </td>\n        <td class="table-cost table__cell">\n          ${t.cost} руб\n        </td>\n        <td>\n          <div class="table__actions table__cell">\n            <button class="button action-change"><span class="svg_ui"><svg class="action-icon_change">\n                  <use xlink:href="./img/sprite.svg#change"></use>\n                </svg></span><span>Изменить</span>\n            </button>\n            <button class="button action-remove"><span class="svg_ui"><svg class="action-icon_remove">\n                 <use xlink:href="./img/sprite.svg#remove"></use>\n               </svg></span><span>Удалить</span>\n            </button>\n          </div>\n        </td>\n      </tr>`)}))},n=()=>{const t=document.getElementById("typeItem"),e=document.getElementById("input-search"),n=document.querySelectorAll(".table-th");let o="",s="";n.forEach((t=>{t.hasAttribute("data-sorting")&&t.hasAttribute("data-sort")&&(o="asc",s=t.dataset.sorting),t.hasAttribute("data-sorting")&&!t.hasAttribute("data-sort")&&(o="desc",s=t.dataset.sorting)})),"Все услуги"===t.value&&""===e.value&&""===o&&dbService.dataGet().then((t=>a(t))),"Все услуги"!==t.value&&""===e.value&&""===o&&dbService.dataGet(`?type=${t.value}`).then((t=>a(t))),""!==e.value&&""===o&&dbService.dataGet(`?q=${e.value}`).then((t=>a(t))),"Все услуги"===t.value&&""===e.value&&""!==o&&dbService.dataGet(`?_sort=${s}&_order=${o}`).then((t=>a(t))),"Все услуги"!==t.value&&""===e.value&&""!==o&&dbService.dataGet(`?_sort=${s}&_order=${o}&type=${t.value}`).then((t=>a(t))),""!==e.value&&""!==o&&dbService.dataGet(`?_sort=${s}&_order=${o}&q=${e.value}`).then((t=>a(t)))},o=(t,e="Все услуги")=>{const a=document.getElementById("typeItem");let n=[];t.forEach((t=>{t.type&&n.push(t.type)})),n=n.filter(((t,e)=>n.indexOf(t.trim())===e)),a.innerHTML='<option value="Все услуги">Все услуги</option>',n.forEach((t=>{a.insertAdjacentHTML("beforeend",`<option value="${t}">${t}</option>`)})),a.value=e};(()=>{const t=window.location.href.slice(0,window.location.href.lastIndexOf("/")),e=t+"/index.html",a=t+"/table.html";window.location.href===e&&"user=auth"===document.cookie&&window.location.replace(a),window.location.href===a&&(document.cookie||window.location.replace(e)),window.location.href!==e&&window.location.href!==a&&window.location.replace(e)})(),(async()=>{const t=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/index.html";window.location.href===t&&await fetch("http://localhost:4545/users").then((t=>t.json())).then((t=>(async t=>{const e=document.querySelector("form"),a=document.getElementById("name"),n=document.getElementById("type"),o=document.querySelector(".text-warning-name"),s=document.querySelector(".text-warning-pass"),l=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/table.html",{name:d,password:c}=t;e.addEventListener("submit",(t=>{t.preventDefault();let e=!0,i=!0;""!=a.value.trim()&&a.value.trim()!==d&&(e=!1,o.style.display="block",a.value="",n.value=""),""!=n.value.trim()&&n.value.trim()!==c&&e&&(i=!1,s.style.display="block",n.value=""),e&&i&&(document.cookie="user=auth; path=/admin",window.location.href=l)})),document.querySelectorAll("input").forEach((t=>{t.addEventListener("focus",(e=>{t===a&&(o.style.display="none"),t===n&&(s.style.display="none")}))}))})(t))).catch((t=>console.log(t)))})(),(async()=>{const t=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/table.html";window.location.href===t&&(window.dbService=new e,await(()=>{const t=document.querySelector(".btn-reset"),e=document.getElementById("input-search"),n=document.getElementById("typeItem"),o=document.querySelectorAll(".table-th");t.addEventListener("click",(t=>{t.preventDefault(),o.forEach((t=>{const e=t.querySelector(".svg_ui");t.removeAttribute("data-sort"),t.removeAttribute("data-sorting"),e&&(e.style.transform="rotate(0)")})),dbService.dataGet().then((t=>a(t))),n.value="Все услуги",e.value=""}))})(),await(()=>{const t=document.getElementById("typeItem"),e=document.getElementById("input-search"),a=((t,e=300)=>{let a;return(...n)=>{clearTimeout(a),a=setTimeout((()=>{t.apply(void 0,n)}),e)}})((()=>{n(),t.value="Все услуги"}),400);e.addEventListener("input",a)})(),await(()=>{const t=document.querySelector(".table thead"),e=document.querySelectorAll(".table-th");t.addEventListener("click",(t=>{const a=t.target.closest(".table-th"),o=a.querySelector(".svg_ui");a.hasAttribute("data-sort")?(a.removeAttribute("data-sort"),o.style.transform="rotate(0)"):(a.classList.contains("th-id")&&(a.dataset.sorting="id",a.dataset.sort=""),a.classList.contains("th-type")&&(a.dataset.sorting="type",a.dataset.sort=""),a.classList.contains("th-name")&&(a.dataset.sorting="name",a.dataset.sort=""),a.classList.contains("th-units")&&(a.dataset.sorting="units",a.dataset.sort=""),o&&(o.style.transform="rotate(180deg)")),e.forEach((e=>{if(t.target.closest(".table-th")!==e){const t=e.querySelector(".svg_ui");e.removeAttribute("data-sort"),e.removeAttribute("data-sorting"),t&&(t.style.transform="rotate(0)")}})),n()}))})(),await(()=>{const t=document.getElementById("tbody"),e=document.getElementById("typeItem");t.addEventListener("click",(async t=>{if(t.target.closest(".action-remove")){t.preventDefault();const a=t.target.closest("tr");await dbService.dataSend("DELETE",[],`/${a.dataset.key}`).then((()=>{n()})),await dbService.dataGet().then((t=>{o(t,e.value)}))}}))})(),await(()=>{const t=document.getElementById("typeItem"),e=document.getElementById("modal"),a=document.getElementById("tbody"),s=document.querySelector(".modal form"),l=document.getElementById("type"),d=document.getElementById("name"),c=document.getElementById("units"),i=document.getElementById("cost");a.addEventListener("click",(t=>{if(t.target.closest(".action-change")){const e=t.target.closest("tr");dbService.dataGet(`/${e.dataset.key}`).then((t=>{l.value=t.type,d.value=t.name,c.value=t.units,i.value=t.cost,s.dataset.edit=`${e.dataset.key}`}))}})),s.addEventListener("submit",(async a=>{if(a.preventDefault(),s.dataset.edit){const a={type:`${l.value}`,name:`${d.value}`,units:`${c.value}`,cost:""+ +i.value};await dbService.dataSend("PATCH",a,`/${s.dataset.edit}`).then((()=>{n()})),await dbService.dataGet().then((e=>{o(e,t.value)})),s.reset(),e.style.display="none",document.body.style.overflow="auto"}}))})(),await(()=>{const t=document.getElementById("typeItem"),e=document.getElementById("modal"),a=document.querySelector(".modal form"),s=document.getElementById("type"),l=document.getElementById("name"),d=document.getElementById("units"),c=document.getElementById("cost");a.addEventListener("submit",(async i=>{i.preventDefault();const r={type:`${s.value}`,name:`${l.value}`,units:`${d.value}`,cost:""+ +c.value};a.dataset.edit||(await dbService.dataSend("POST",r).then((()=>{n()})),await dbService.dataGet().then((e=>{o(e,t.value)})),a.reset(),e.style.display="none",document.body.style.overflow="auto")}))})(),await(()=>{const t=document.getElementById("input-search");document.getElementById("typeItem").addEventListener("input",(e=>{t.value="",n()}))})(),await dbService.dataGet().then((t=>{n(),o(t)})),(()=>{const t=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/index.html";document.querySelector(".btn-exit").addEventListener("click",(e=>{e.preventDefault(),document.cookie="user=auth; path=/admin; max-age=0",window.location.href=t}))})(),(()=>{const t=document.getElementById("modal"),e=t.querySelector(".modal__header");document.addEventListener("click",(a=>{a.target.closest(".btn-addItem")&&(a.preventDefault(),t.style.display="flex",document.body.style.overflow="hidden",e.textContent="Добавление новой услуги"),a.target.closest(".action-change")&&(a.preventDefault(),t.style.display="flex",document.body.style.overflow="hidden",e.textContent="Редактировать услугу"),(a.target.closest(".cancel-button")||a.target.closest(".button__close")||a.target===t)&&(a.preventDefault(),t.style.display="none",document.body.style.overflow="auto")}))})())})()})();