(()=>{"use strict";const t=()=>document.querySelector("table").insertAdjacentHTML("afterend",'<p style="width:400px;margin: 0 auto;">Произошла ошибка, данных нет!</p>');class e{async dataGet(e=""){try{const a=await fetch(`http://localhost:4545/data${e}`);if(a.ok)return await a.json();throw t()}catch(t){t()}}async dataSend(e,a,n=""){try{const o=await fetch(`http://localhost:4545/data${n}`,{method:e,headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(a)});if(o.ok)return await o.json();throw t()}catch(t){t()}}}const a=t=>{const e=document.getElementById("tbody");e.innerHTML="",t.forEach((t=>{e.insertAdjacentHTML("beforeend",`<tr class="table__row" data-key="${t.id}">\n        <td class="table__id table__cell">${t.id}</td>\n        <td class="table-type table__cell">${t.type}</td>\n        <td class="table-name table__cell">\n          ${t.name}\n        </td>\n        <td class="table-units table__cell">\n          ${"м2"===t.units?t.units[0]+"<sup>"+t.units[1]:t.units}\n        </td>\n        <td class="table-cost table__cell">\n          ${t.cost} руб\n        </td>\n        <td>\n          <div class="table__actions table__cell">\n            <button class="button action-change"><span class="svg_ui"><svg class="action-icon_change">\n                  <use xlink:href="./img/sprite.svg#change"></use>\n                </svg></span><span>Изменить</span>\n            </button>\n            <button class="button action-remove"><span class="svg_ui"><svg class="action-icon_remove">\n                 <use xlink:href="./img/sprite.svg#remove"></use>\n               </svg></span><span>Удалить</span>\n            </button>\n          </div>\n        </td>\n      </tr>`)}))},n=()=>{const t=document.getElementById("typeItem");"Все услуги"===t.value?dbService.dataGet().then((t=>a(t))):dbService.dataGet(`?type=${t.value}`).then((t=>a(t)))},o=t=>{const e=document.getElementById("typeItem");let a=[];t.forEach((t=>{t.type&&a.push(t.type)})),a=a.filter(((t,e)=>a.indexOf(t.trim())===e)),e.innerHTML='<option value="Все услуги">Все услуги</option>',a.forEach((t=>{e.insertAdjacentHTML("beforeend",`<option value="${t}">${t}</option>`)}))};(()=>{const t=window.location.href.slice(0,window.location.href.lastIndexOf("/")),e=t+"/",a=t+"/table.html";window.location.href===e&&"user=auth"===document.cookie&&window.location.replace(a),window.location.href===a&&(document.cookie||window.location.replace(e)),window.location.href!==e&&window.location.href!==a&&window.location.replace(e)})(),(async()=>{const t=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/";window.location.href===t&&await fetch("http://localhost:4545/users").then((t=>t.json())).then((t=>(async t=>{const e=document.querySelector("form"),a=document.getElementById("name"),n=document.getElementById("type"),o=document.querySelector(".text-warning-name"),s=document.querySelector(".text-warning-pass"),d=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/table.html",{name:c,password:l}=t;e.addEventListener("submit",(t=>{t.preventDefault();let e=!0,r=!0;""!=a.value.trim()&&a.value.trim()!==c&&(e=!1,o.style.display="block",a.value="",n.value=""),""!=n.value.trim()&&n.value.trim()!==l&&e&&(r=!1,s.style.display="block",n.value=""),e&&r&&(document.cookie="user=auth; path=/admin",window.location.href=d)})),document.querySelectorAll("input").forEach((t=>{t.addEventListener("focus",(e=>{t===a&&(o.style.display="none"),t===n&&(s.style.display="none")}))}))})(t))).catch((t=>console.log(t)))})(),(async()=>{const t=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/table.html";window.location.href===t&&(window.dbService=new e,await(()=>{const t=document.querySelector(".btn-reset"),e=document.getElementById("input-search"),n=document.getElementById("typeItem"),o=document.querySelectorAll(".table-th");t.addEventListener("click",(t=>{t.preventDefault(),o.forEach((t=>{const e=t.querySelector(".svg_ui");t.removeAttribute("data-sort"),t.removeAttribute("data-sorting"),e&&(e.style.transform="rotate(0)")})),dbService.dataGet().then((t=>a(t))),n.value="Все услуги",e.value=""}))})(),await(()=>{const t=document.getElementById("typeItem"),e=document.getElementById("input-search"),n=document.querySelectorAll(".table-th"),o=((t,e=300)=>{let a;return(...n)=>{clearTimeout(a),a=setTimeout((()=>{t.apply(void 0,n)}),e)}})((()=>{dbService.dataGet(`?q=${e.value}`).then((t=>a(t))),n.forEach((t=>{const e=t.querySelector(".svg_ui");t.removeAttribute("data-sort"),t.removeAttribute("data-sorting"),e&&(e.style.transform="rotate(0)")})),t.value="Все услуги"}),400);e.addEventListener("input",o)})(),await(()=>{const t=document.querySelector(".table thead"),e=document.getElementById("typeItem"),n=document.getElementById("input-search");t.addEventListener("click",(t=>{const o=t.target.closest(".table-th"),s=o.querySelector(".svg_ui");o.hasAttribute("data-sort")?(o.removeAttribute("data-sort"),s.style.transform="rotate(0)"):(o.classList.contains("th-id")&&(o.dataset.sorting="id",o.dataset.sort=""),o.classList.contains("th-type")&&(o.dataset.sorting="type",o.dataset.sort=""),o.classList.contains("th-name")&&(o.dataset.sorting="name",o.dataset.sort=""),o.classList.contains("th-units")&&(o.dataset.sorting="units",o.dataset.sort=""),s&&(s.style.transform="rotate(180deg)")),""!==n.value?(console.log(1),dbService.dataGet(`?_sort=${o.dataset.sorting}&_order=${o.hasAttribute("data-sort")?"asc":"desc"}&q=${n.value}`).then((t=>a(t)))):"Все услуги"!==e.value?dbService.dataGet(`?_sort=${o.dataset.sorting}&_order=${o.hasAttribute("data-sort")?"asc":"desc"}&type=${e.value}`).then((t=>a(t))):dbService.dataGet(`?_sort=${o.dataset.sorting}&_order=${o.hasAttribute("data-sort")?"asc":"desc"}`).then((t=>a(t)))}))})(),await void document.getElementById("tbody").addEventListener("click",(t=>{if(t.target.closest(".action-remove")){t.preventDefault();const e=t.target.closest("tr");dbService.dataSend("DELETE",[],`/${e.dataset.key}`).then((()=>{n()})),dbService.dataGet().then((t=>{o(t)}))}})),await(()=>{const t=document.getElementById("modal"),e=document.getElementById("tbody"),a=document.querySelector(".modal form"),s=document.getElementById("type"),d=document.getElementById("name"),c=document.getElementById("units"),l=document.getElementById("cost");e.addEventListener("click",(t=>{if(t.target.closest(".action-change")){const e=t.target.closest("tr");dbService.dataGet(`/${e.dataset.key}`).then((t=>{s.value=t.type,d.value=t.name,c.value=t.units,l.value=t.cost,a.dataset.edit=`${e.dataset.key}`}))}})),a.addEventListener("submit",(e=>{if(e.preventDefault(),a.dataset.edit){const e={type:`${s.value}`,name:`${d.value}`,units:`${c.value}`,cost:""+ +l.value};dbService.dataSend("PATCH",e,`/${a.dataset.edit}`).then((()=>{n()})),dbService.dataGet().then((t=>{o(t)})),a.reset(),t.style.display="none",document.body.style.overflow="auto"}}))})(),await(()=>{const t=document.getElementById("modal"),e=document.querySelector(".modal form"),a=document.getElementById("type"),s=document.getElementById("name"),d=document.getElementById("units"),c=document.getElementById("cost");e.addEventListener("submit",(l=>{l.preventDefault();const r={type:`${a.value}`,name:`${s.value}`,units:`${d.value}`,cost:""+ +c.value};e.dataset.edit||(dbService.dataSend("POST",r).then((()=>{n()})),dbService.dataGet().then((t=>{o(t)})),e.reset(),t.style.display="none",document.body.style.overflow="auto")}))})(),await(()=>{const t=document.getElementById("input-search"),e=document.getElementById("typeItem"),a=document.querySelectorAll(".table-th");e.addEventListener("input",(e=>{n(),a.forEach((t=>{const e=t.querySelector(".svg_ui");t.removeAttribute("data-sort"),t.removeAttribute("data-sorting"),e&&(e.style.transform="rotate(0)")})),t.value=""}))})(),await dbService.dataGet().then((t=>{n(),o(t)})),(()=>{const t=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/";document.querySelector(".btn-exit").addEventListener("click",(e=>{e.preventDefault(),document.cookie="user=auth; path=/admin; max-age=0",window.location.href=t}))})(),(()=>{const t=document.getElementById("modal"),e=t.querySelector(".modal__header");document.addEventListener("click",(a=>{a.target.closest(".btn-addItem")&&(a.preventDefault(),t.style.display="flex",document.body.style.overflow="hidden",e.textContent="Добавление новой услуги"),a.target.closest(".action-change")&&(a.preventDefault(),t.style.display="flex",document.body.style.overflow="hidden",e.textContent="Редактировать услугу"),(a.target.closest(".cancel-button")||a.target.closest(".button__close")||a.target===t)&&(a.preventDefault(),t.style.display="none",document.body.style.overflow="auto")}))})())})()})();