(()=>{"use strict";const t=()=>document.querySelector("table").insertAdjacentHTML("afterend",'<p style="width:400px;margin: 0 auto;">Произошла ошибка, данных нет!</p>');class e{async dataGet(e=""){try{const n=await fetch(`http://localhost:4545/data${e}`);if(n.ok)return await n.json();throw t()}catch(t){t()}}async dataSend(e,n,a=""){try{const o=await fetch(`http://localhost:4545/data${a}`,{method:e,headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(n)});if(o.ok)return await o.json();throw t()}catch(t){t()}}addData(t){return this.dataSend("POST",t)}removeData(t){return this.dataSend("DELETE",[],`/${t}`)}changePermission(t,e){return this.dataSend("PATCH",e,`/${t}`)}editData(t,e){return this.dataSend("PUT",e,`/${t}`)}filterData(t){return this.dataGet(t)}sortData(t){return this.dataGet(t)}searchData(t){return this.dataGet(t)}}const n=t=>{const e=document.getElementById("tbody");e.innerHTML="",t.forEach((t=>{e.insertAdjacentHTML("beforeend",`<tr class="table__row">\n        <td class="table__id table__cell">${t.id}</td>\n        <td class="table-type table__cell">${t.type}</td>\n        <td class="table-name table__cell">\n          ${t.name}\n        </td>\n        <td class="table-units table__cell">\n          ${"м2"===t.units?t.units[0]+"<sup>"+t.units[1]:t.units}\n        </td>\n        <td class="table-cost table__cell">\n          ${t.cost} руб\n        </td>\n        <td>\n          <div class="table__actions table__cell">\n            <button class="button action-change"><span class="svg_ui"><svg class="action-icon_change">\n                  <use xlink:href="./img/sprite.svg#change"></use>\n                </svg></span><span>Изменить</span>\n            </button>\n            <button class="button action-remove"><span class="svg_ui"><svg class="action-icon_remove">\n                 <use xlink:href="./img/sprite.svg#remove"></use>\n               </svg></span><span>Удалить</span>\n            </button>\n          </div>\n        </td>\n      </tr>`)}))};(()=>{const t=window.location.href.slice(0,window.location.href.lastIndexOf("/")),e=t+"/",n=t+"/table.html";JSON.parse(localStorage.getItem("auth")),window.location.href===e&&"user=auth"===document.cookie&&window.location.replace(n),window.location.href===n&&(document.cookie||window.location.replace(e)),window.location.href!==e&&window.location.href!==n&&window.location.replace(e)})(),(async()=>{const t=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/";window.location.href===t&&await fetch("http://localhost:4545/users").then((t=>t.json())).then((t=>(async t=>{const e=document.querySelector("form"),n=document.getElementById("name"),a=document.getElementById("type"),o=document.querySelector(".text-warning-name"),l=document.querySelector(".text-warning-pass"),s=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/table.html",{name:c,password:d}=t[0];e.addEventListener("submit",(t=>{t.preventDefault();let e=!0,i=!0;""!=n.value.trim()&&n.value.trim()!==c&&(e=!1,o.style.display="block",n.value="",a.value=""),""!=a.value.trim()&&a.value.trim()!==d&&e&&(i=!1,l.style.display="block",a.value=""),e&&i&&(document.cookie="user=auth; path=/admin",window.location.href=s)})),document.querySelectorAll("input").forEach((t=>{t.addEventListener("focus",(e=>{t===n&&(o.style.display="none"),t===a&&(l.style.display="none")}))}))})(t))).catch((t=>console.log(t)))})(),(async()=>{const a=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/table.html";window.location.href===a&&(window.dbService=new e,await(()=>{const e=document.getElementById("modal"),a=document.querySelector(".modal form"),o=document.getElementById("type"),l=document.getElementById("name"),s=document.getElementById("units"),c=document.getElementById("cost");a.addEventListener("submit",(d=>{d.preventDefault();const i={type:`${o.value}`,name:`${l.value}`,units:`${s.value}`,cost:""+ +c.value};dbService.addData(i).then((()=>{dbService.dataGet().then((t=>n(t))).catch((()=>t()))})),a.reset(),e.style.display="none",document.body.style.overflow="auto"}))})(),await void document.getElementById("typeItem").addEventListener("input",(t=>{"Все услуги"===t.target.value?dbService.filterData("").then((t=>n(t))):dbService.filterData(`?type=${t.target.value}`).then((t=>n(t)))})),await dbService.dataGet().then((t=>{n(t),(t=>{const e=document.getElementById("typeItem");let n=[];t.forEach((t=>{t.type&&n.push(t.type)})),n=n.filter(((t,e)=>n.indexOf(t.trim())===e)),n.forEach((t=>{e.insertAdjacentHTML("beforeend",`<option value="${t}">${t}</option>`)}))})(t)})),(()=>{const t=document.getElementById("modal");document.addEventListener("click",(e=>{e.target.closest(".btn-addItem")&&(e.preventDefault(),t.style.display="flex",document.body.style.overflow="hidden"),(e.target.closest(".cancel-button")||e.target.closest(".button__close")||e.target===t)&&(e.preventDefault(),t.style.display="none",document.body.style.overflow="auto")}))})())})()})();