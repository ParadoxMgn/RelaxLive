(()=>{"use strict";const t=()=>document.querySelector("table").insertAdjacentHTML("afterend",'<p style="width:400px;margin: 0 auto;">Произошла ошибка, данных нет!</p>');class e{async dataGet(e=""){try{const n=await fetch(`http://localhost:4545/data${e}`);if(n.ok)return await n.json();throw t()}catch(t){t()}}async dataSend(e,n,a=""){try{const o=await fetch(`http://localhost:4545/data${a}`,{method:e,headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(n)});if(o.ok)return await o.json();throw t()}catch(t){t()}}}const n=t=>{const e=document.getElementById("tbody");e.innerHTML="",t.forEach((t=>{e.insertAdjacentHTML("beforeend",`<tr class="table__row" data-key="${t.id}">\n        <td class="table__id table__cell">${t.id}</td>\n        <td class="table-type table__cell">${t.type}</td>\n        <td class="table-name table__cell">\n          ${t.name}\n        </td>\n        <td class="table-units table__cell">\n          ${"м2"===t.units?t.units[0]+"<sup>"+t.units[1]:t.units}\n        </td>\n        <td class="table-cost table__cell">\n          ${t.cost} руб\n        </td>\n        <td>\n          <div class="table__actions table__cell">\n            <button class="button action-change"><span class="svg_ui"><svg class="action-icon_change">\n                  <use xlink:href="./img/sprite.svg#change"></use>\n                </svg></span><span>Изменить</span>\n            </button>\n            <button class="button action-remove"><span class="svg_ui"><svg class="action-icon_remove">\n                 <use xlink:href="./img/sprite.svg#remove"></use>\n               </svg></span><span>Удалить</span>\n            </button>\n          </div>\n        </td>\n      </tr>`)}))},a=()=>{const t=document.getElementById("typeItem");"Все услуги"===t.value?dbService.dataGet().then((t=>n(t))):dbService.dataGet(`?type=${t.value}`).then((t=>n(t)))};(()=>{const t=window.location.href.slice(0,window.location.href.lastIndexOf("/")),e=t+"/",n=t+"/table.html";window.location.href===e&&"user=auth"===document.cookie&&window.location.replace(n),window.location.href===n&&(document.cookie||window.location.replace(e)),console.log(e),console.log(n),window.location.href!==e&&window.location.href!==n&&window.location.replace(e)})(),(async()=>{const t=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/";window.location.href===t&&await fetch("http://localhost:4545/users").then((t=>t.json())).then((t=>(async t=>{const e=document.querySelector("form"),n=document.getElementById("name"),a=document.getElementById("type"),o=document.querySelector(".text-warning-name"),s=document.querySelector(".text-warning-pass"),d=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/table.html",{name:l,password:c}=t;e.addEventListener("submit",(t=>{t.preventDefault();let e=!0,r=!0;""!=n.value.trim()&&n.value.trim()!==l&&(e=!1,o.style.display="block",n.value="",a.value=""),""!=a.value.trim()&&a.value.trim()!==c&&e&&(r=!1,s.style.display="block",a.value=""),e&&r&&(document.cookie="user=auth; path=/admin",window.location.href=d)})),document.querySelectorAll("input").forEach((t=>{t.addEventListener("focus",(e=>{t===n&&(o.style.display="none"),t===a&&(s.style.display="none")}))}))})(t))).catch((t=>console.log(t)))})(),(async()=>{const t=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/table.html";window.location.href===t&&(window.dbService=new e,await(()=>{const t=document.querySelector(".btn-reset"),e=document.getElementById("input-search"),a=document.getElementById("typeItem"),o=document.querySelectorAll(".table-th");t.addEventListener("click",(t=>{t.preventDefault(),o.forEach((t=>{const e=t.querySelector(".svg_ui");t.removeAttribute("data-sort"),t.removeAttribute("data-sorting"),e&&(e.style.transform="rotate(0)")})),dbService.dataGet().then((t=>n(t))),a.value="Все услуги",e.value=""}))})(),await(()=>{const t=document.getElementById("typeItem"),e=document.getElementById("input-search"),a=document.querySelectorAll(".table-th"),o=((t,e=300)=>{let n;return(...a)=>{clearTimeout(n),n=setTimeout((()=>{t.apply(void 0,a)}),e)}})((()=>{dbService.dataGet(`?q=${e.value}`).then((t=>n(t))),a.forEach((t=>{const e=t.querySelector(".svg_ui");t.removeAttribute("data-sort"),t.removeAttribute("data-sorting"),e&&(e.style.transform="rotate(0)")})),t.value="Все услуги"}),400);e.addEventListener("input",o)})(),await(()=>{const t=document.querySelector(".table thead"),e=document.getElementById("typeItem"),a=document.getElementById("input-search");t.addEventListener("click",(t=>{const o=t.target.closest(".table-th"),s=o.querySelector(".svg_ui");o.hasAttribute("data-sort")?(o.removeAttribute("data-sort"),s.style.transform="rotate(0)"):(o.classList.contains("th-id")&&(o.dataset.sorting="id",o.dataset.sort=""),o.classList.contains("th-type")&&(o.dataset.sorting="type",o.dataset.sort=""),o.classList.contains("th-name")&&(o.dataset.sorting="name",o.dataset.sort=""),o.classList.contains("th-units")&&(o.dataset.sorting="units",o.dataset.sort=""),s&&(s.style.transform="rotate(180deg)")),""!==a.value?(console.log(1),dbService.dataGet(`?_sort=${o.dataset.sorting}&_order=${o.hasAttribute("data-sort")?"asc":"desc"}&q=${a.value}`).then((t=>n(t)))):"Все услуги"!==e.value?dbService.dataGet(`?_sort=${o.dataset.sorting}&_order=${o.hasAttribute("data-sort")?"asc":"desc"}&type=${e.value}`).then((t=>n(t))):dbService.dataGet(`?_sort=${o.dataset.sorting}&_order=${o.hasAttribute("data-sort")?"asc":"desc"}`).then((t=>n(t)))}))})(),await void document.getElementById("tbody").addEventListener("click",(t=>{if(t.target.closest(".action-remove")){t.preventDefault();const e=t.target.closest("tr");dbService.dataSend("DELETE",[],`/${e.dataset.key}`).then((()=>{a()}))}})),await(()=>{const t=document.getElementById("modal"),e=document.getElementById("tbody"),n=document.querySelector(".modal form"),o=document.getElementById("type"),s=document.getElementById("name"),d=document.getElementById("units"),l=document.getElementById("cost");e.addEventListener("click",(t=>{if(t.target.closest(".action-change")){const e=t.target.closest("tr");dbService.dataGet(`/${e.dataset.key}`).then((t=>{o.value=t.type,s.value=t.name,d.value=t.units,l.value=t.cost,n.dataset.edit=`${e.dataset.key}`}))}})),n.addEventListener("submit",(e=>{if(e.preventDefault(),n.dataset.edit){const e={type:`${o.value}`,name:`${s.value}`,units:`${d.value}`,cost:""+ +l.value};dbService.dataSend("PATCH",e,`/${n.dataset.edit}`).then((()=>{a()})),n.reset(),t.style.display="none",document.body.style.overflow="auto"}}))})(),await(()=>{const t=document.getElementById("modal"),e=document.querySelector(".modal form"),n=document.getElementById("type"),o=document.getElementById("name"),s=document.getElementById("units"),d=document.getElementById("cost");e.addEventListener("submit",(l=>{l.preventDefault();const c={type:`${n.value}`,name:`${o.value}`,units:`${s.value}`,cost:""+ +d.value};e.dataset.edit||(dbService.dataSend("POST",c).then((()=>{a()})),e.reset(),t.style.display="none",document.body.style.overflow="auto")}))})(),await(()=>{const t=document.getElementById("input-search"),e=document.getElementById("typeItem"),n=document.querySelectorAll(".table-th");e.addEventListener("input",(e=>{a(),n.forEach((t=>{const e=t.querySelector(".svg_ui");t.removeAttribute("data-sort"),t.removeAttribute("data-sorting"),e&&(e.style.transform="rotate(0)")})),t.value=""}))})(),await dbService.dataGet().then((t=>{a(),(t=>{const e=document.getElementById("typeItem");let n=[];t.forEach((t=>{t.type&&n.push(t.type)})),n=n.filter(((t,e)=>n.indexOf(t.trim())===e)),n.forEach((t=>{e.insertAdjacentHTML("beforeend",`<option value="${t}">${t}</option>`)}))})(t)})),(()=>{const t=window.location.href.slice(0,window.location.href.lastIndexOf("/"))+"/";document.querySelector(".btn-exit").addEventListener("click",(e=>{e.preventDefault(),document.cookie="user=auth; path=/admin; max-age=0",window.location.href=t}))})(),(()=>{const t=document.getElementById("modal"),e=t.querySelector(".modal__header");document.addEventListener("click",(n=>{n.target.closest(".btn-addItem")&&(n.preventDefault(),t.style.display="flex",document.body.style.overflow="hidden",e.textContent="Добавление новой услуги"),n.target.closest(".action-change")&&(n.preventDefault(),t.style.display="flex",document.body.style.overflow="hidden",e.textContent="Редактировать услугу"),(n.target.closest(".cancel-button")||n.target.closest(".button__close")||n.target===t)&&(n.preventDefault(),t.style.display="none",document.body.style.overflow="auto")}))})())})()})();